version: 0.2

env:
  parameter-store:
    DEPLOY_KEY: "Test-Platform-CB-GH-DeployKey"

phases:
  install:
    commands:
      - echo Installing boto3
      - pip install -U boto3
      - echo Finished installing boto3
      - cat $DEPLOY_KEY > ~/.ssh/deploy_key
      - chmod 600 ~/.ssh/deploy_key
      - ssh-add ~/.ssh/deploy_key
      - git config --global user.email "timothy.leavey@gmail.com"
      - git config --global user.name "tleavey"
  build:
    commands:
      - echo Going to sleep for 5 minutes.
#      - sleep 300
      - echo Just woke up.
      - echo Running status_checker.py
      - python status_checker.py
      - echo Status Checker Build Completed
      - pwd
      - ls -la
      - git status
      - git add cfn-stack-results.md
      - git commit -m "Updated cfn stack results."
      - git push
  post_build:
    commands:
      - echo Setting public-read permissions on output
      - aws s3 mv --acl public-read cfn-stack-results.md s3://tleavey-test-platform-status/cfnResults/
      - echo The cfn-stack-results have been moved successfully.